---
title: "SURE Project"
author: ""
date: "`r format(Sys.Date(), '%B %d, %Y')`"
graphics: yes
output: pdf_document
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T,
                      cache = T,
                      eval = T,
                      message = F,
                      warning = F,
                      fig.width = 8,
                      fig.height = 10,
                      fig.align = 'center')
library(sp)
library(sf)
library(terra)
library(raster)
library(rgdal)
library(pander)
library(magrittr)
library(ggplot2)
library(dplyr)
library(tidyr)
library(RColorBrewer)
library(here)
library(plotrix)
```

## Objective

Summarize results.

```{r}
# clear environment
rm(list = ls())

# set a directory
d.dir <- here('data')
r.dir <- '/Volumes/Chunting HD/Git_Repositories/Chunting_Spatial_Analyses/spatial_data'
```

Calculate the average of predicted kelp density for each resolution from 2004 to 2021 in the North Coast.

```{r}
year <- 2004:2021
res <- c(120, 300, 900, 1500)

# initialize an empty data frame
kelp.density <- data.frame(year = factor(),
                           resolution = factor(),
                           fit = numeric())

for (i in res) {
  res.dir <- paste(r.dir, paste0('sp_predictions_', i, 'm'), sep = '/')
  for (j in year) {
    mean.fit <- rast(paste0(res.dir, paste0('/', j, '_Log_Nereo_NC.tif'))) %>%
      values() %>%
      mean(na.rm = TRUE)
    data <- data.frame(year = factor(j), resolution = factor(i), fit = mean.fit)
    kelp.density <- rbind(kelp.density, data)
  }
}
```

Calculate the average of Landsat kelp area from 2004 to 2021 in the North Coast.

```{r}
area <- read.csv(paste(d.dir, 'NC_Landsat_kelp_area_1984_2021.csv', sep = '/')) %>%
  filter(quarter == 3) %>%
  mutate_at(vars(year, quarter), list(as.factor))

# initialize an empty data frame
kelp.area <- data.frame(year = factor(),
                        area = numeric(),
                        se = numeric())

for (i in year) {
  mean.area <- area %>%
    filter(year == i) %>%
    summarise_at(vars(area), list(mean = mean, se = std.error), na.rm = TRUE) %>%
    mutate(year = factor(i), .before = mean)
  kelp.area <- rbind(kelp.area, setNames(mean.area, names(kelp.area)))
}
```


Calculate the average of "in situ" survey data from 2004 to 2021 in the North Coast.

```{r}
# read and transform the observed data to the log scale
obs.data <- read.csv(paste(d.dir, 
                           'RCCA_kelp_inverts_NC_depth-zones_wave_clim_temp_nit_subs_orbvel_npp.csv',
                           sep = '/')) %>%
  dplyr::select(site_name, year, transect, zone, latitude, longitude, den_NERLUE) %>%
  mutate_at(vars(year, transect, zone, site_name), list(as.factor)) %>%
  mutate(log_den_NERLUE = log(den_NERLUE)) 
```

